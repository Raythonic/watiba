#!/usr/bin/python3.8
import os
import re

`cd /tmp`
-`cd /mnt/data`

print("CWD is not /home: {}".format(-`cd /home`.cwd))

# This will find text file in /tmp/, not /mnt/data
w=`find . -name '*.txt'`
for l in w.stdout:
    print("File: {}".format(l))


print(`echo "BLAH!" > /tmp/blah.txt && tar -zcvf /tmp/blah.tar.gz /tmp/blah.txt`.stderr)
print(-`echo "hello!"`.stdout[0])

# Example of more than one command in a statement line
if len(`ls -lrt`.stdout) > 0 or len(-`cd /tmp`.stdout) > 0:
    print("You have stdout or stderr messages")


# Example of receiving a Watiba object and operating from that
cmd = "tar -zcvf /tmp/watiba_test.tar.gz /mnt/data/git/watiba/src"
results = `$cmd`
if results.exit_code == 0:
    for l in results.stderr:
        print(l)

# read the output example 2
#  Iterate on the stdout property
for l in `ls -lrt`.stdout:
    print(l)

# example of a failed command to see its exit code
xc = `lsvv -lrt`.exit_code
print("Return code: {}".format(xc))

# another example
print("Return code: {}".format(`ls gg`.exit_code))

print(`pwd`.cwd)

# Experimental promise
print("running async test")
`rm /tmp/done`
w_async(`ls -lrt`):
    # This is the resolver block
    print("Async command done!")
    print("results {}".format(results.stdout))
    `touch /tmp/done`

while not os.path.exists("/tmp/done"):
    `sleep 3`

print("test complete.")
